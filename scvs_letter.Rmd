---
title: "Inoculating the economy: a causality discussion on vaccines and economic recovery"
author: "Daniel Sánchez"
date: "April 2022"
output:
  word_document:
    reference_docx: others/scvs-template.docx
    number_sections: yes
  pdf_document: default
bibliography: refs/refs.bib
csl: refs/apa.csl
link-citations: yes
description: The .Rmd file for my economic letter for the X-Pedientes Journal from
  SCVS.
---

```{r setup, include = FALSE}
# Default option is to not show code in the document, only results

knitr::opts_chunk$set(echo = F, fig.width = 20, fig.height = 6)

# Load libraries

library(modelsummary)
library(tidyverse)
library(patchwork)
library(showtext)
library(fixest)
library(openxlsx)
library(fwildclusterboot)
# Load the principal dataframe

df<-read.csv('data/df.csv')

# Change to decimal separator

options(OutDec = ',')

```

# Abstract

The COVID-19 pandemic severely disrupted economic activity worldwide. In Ecuador, the pandemic found an epicenter in the city of Guayaquil during April 2020, where the excess death rate skyrocketed to almost 700%. However, in mid-2021, Ecuador had a glimpse of hope again as the vaccination process turned extremely effective and under a hundred days half of the country's population was inoculated. While since then excess deaths have remained at all-time lows in the pandemic era, the Ecuadorian economy remains weakened. This paper discusses a causal effect of vaccination on economic recovery by implementing a two-way fixed effects difference-in-differences estimator on a repeated cross section of Ecuador 2020-2021 at the province-level. Evidence is found that provinces with apparent vaccine-hesitant populations see about 25% less business creation than provinces with openness to vaccination. This finding stresses the importance of fostering vaccination among populations in a country, especially if booster shots are necessary in the future. This effect is found by leaving out the creation of SAS (*Sociedad de Acciones Simplificada*) businesses, a new firm legal figure introduced to the country in Mid-May, which prompted the creation of many new formal businesses due to the reduction of entry costs. Only minimal evidence of differential prior trends is found, which supports the existence of causality. Finally, other estimation methodologies are proposed to identify a more precise causal effect of vaccination on economic activity. 

# Resumen

La pandemia del COVID-19 interrumpió severamente la actividad económica mundial. En Ecuador, la pandemia encontró un epicentro en la ciudad de Guayaquil en abril del 2020, en donde la tasa de mortalidad en exceso llegó a casi el 700%. Sin embargo, en la mitad del 2021 el Ecuador encontró un destello de esperanza cuando el proceso de vacunación se tornó extremadamente efectivo y en menos de cien días más de la mitad de población se inoculó completamente. Aunque desde ese momento las muertes en exceso se mantienen en mínimos históricos en la era de la pandemia, la economía ecuatoriana se mantiene debilitada. Este artículo discute un efecto causal de la vacunación en la reactivación económica utilizando un estimador diferencia-en-diferencias de efectos fijos de doble vía en una sección transversal repetida del Ecuador 2020-2021 a nivel provincial. Se encuentra evidencia de que provincias con poblaciones aparentemente resistentes a la vacunación ven aproximadamente un 25% menos de creación de empresas, en comparación a provincias más abiertas a la vacunación. Este hallazgo resalta la importancia de fomentar la vacunación en las poblaciones de un país, especialmente si dosis de refuerzo se requieren en el futuro. Este efecto se encuentra eliminado la creación de compañías SAS (*Sociedad de Acciones Simplificada*), una figura legal de compañía introducida en el país en la mitad del 2020 que ocasionó la creación de varias nuevas firmas formales debido a la reducción considerable de costos de entrada. Solo se encuentra evidencia mínima de tendencias previas no similares, lo que apoya a la existencia de causalidad. Finalmente, se proponen otras metodologías de estimación para identificar un efecto causal más preciso de la vacunación en la actividad económica. 

# Introduction

Although the 21st century is still far from over, COVID-19 will necessarily be reminded as one of the most important happenings of the time. The changes that the pandemic has brought about have been long-lasting, as the virus which originally emerged in China by late 2019 has had effects still suffered by the time this article was written. In April 2020, the IMF predicted that the economic effects of the pandemic would be the greatest since the Great Depression [@IMF.April2020]. By October 2020, the IMF revised down their projections of world economic growth and the pandemic accumulated over a million deaths to COVID-19, proving to be a worse crisis than what it was initially expected. It was understood that both the health risks posed by COVID-19 and the lockdown policy enacted by the world's governments had greatly hampered economic conditions around the world, especially in the Western Hemisphere [-@IMF.Oct2020].

Ecuador barely escaped economic and social chaos by securing an agreement with the IMF in 2020 worth 6.5 billion dollars after facing terrible consequences due to high public debt and the precipitous fall of oil prices [@IMF.Oct2020.Art]. However, the Ecuadorian economy was still expected to shrink by 11% in 2020 and its unemployment rate was expected to increase in `r 8.1 - 3.8` percentage points relative to 2019 [@IMF.Oct2020]. Guayas became the COVID-19 epicenter in Ecuador with a 900% excess deaths rate [@Naranjo.2020] and with its capital Guayaquil becoming an international attention center due to the extreme humanitarian crisis caused by the COVID-19 impact [@Zibell.2020]. 

However, by 2021 new hope surfaced as newly-developed COVID-19 vaccines received authorities approval and started to be massively distributed around the world by April 2021. The actual economic downturn in 2020 was smaller for both Ecuador and the global economy as well, which encouraged hopes for the coming year. The IMF revised its 2021 projections upward as vaccine rollouts developed in the United States and other developed economies [-@IMF.April2021]. However, on the developing world and notably in Ecuador vaccine distribution became increasingly unequal, as top government officials and private agents received their first vaccine doses before those that actually needed them [@Taj.2021]. In Ecuador the immunization process was initially slow and corrupt: the Ministry of Health's mother and two well-connected TikTok influencers received a vaccination dose before some first-line workers were even eligible to receive one [@Machado.2021; @Sandoval.2021]. Corruption in vaccination and public health contracting played a key role in the resignations and removals of four Ministries of Health between March 2020 and April 2021. 

Yet once again Ecuador became the center of international attention in the second half of 2021 as its sovereign bonds provided the best returns in the world after the possession of economically-liberal President Guillermo Lasso [@Vizcaino.2021]. The Lasso Administration was able to immunize over half of the country's population in 100 days after his possesion in May 24th, which may have converted Lasso into one of the most popular presidents in the region by October 2021 [@Hurtado.2021]. The new Administration's economic agenda promised economic recovery through investment-friendly policy [@Madrid.2021], even marketing the massive vaccination plan as an initial step for recovery after the pandemic shock [@Brik.2021].

The Ecuadorian economy grew 4.2% in 2021 [@BCE.2022], 50% more than the October 2021 IMF projection [-@IMF.Oct2021].The Ecuadorian Central Bank attributes the increases due to important economic gains in the oil, tourism, agriculture and commerce industries, citing the economic effects brought about by the successful vaccine rollout as the main motivator for the internal economic reactivation. However, the statement by the institution may pose an important causal inference issue: even if vaccines have proven to be successful in mitigating COVID-19 infection [@Katella.2022], not much is known about their effect on economic activity. Additionally, the vaccination process may also correlate with other reactivation motivators which may become confounders. Among them stand the `r (78.90/48.52) * 100` % increase in the price of the WTI oil barrel [@MarketWatch.2022] and the loosening of pandemic restrictions which took place after Lasso took office. 

The aim of this paper is to discuss the possibility of a causal effect of COVID-19 vaccination in economic recovery. This is done by implementing a regression-based approach to a difference-in-differences research design to estimate an average treatment effect of vaccine hesitancy in two proxies of economic activity. Province-level data from Ecuador on several economic and demographic indicators published in a monthly basis is used for the econometric analysis, which focuses on the 24 months between January 2020 and December 2021. 

# Literature Review 

In general, literature on COVID-19 and its economic effects which focuses on causal inference is limited. More has been said about causal effects of vaccination and social distancing measures on health outcomes. Causal evidence has been found in support of social distancing and lockdown measures as a means to reduce infections in the COVID-19 pandemic [@Banerjee.2020; @Sharkey.2020] as well as in other pandemics [@Stern.2009; Bootsma.2007; @Mandavilli.2020]. Numerous randomized trials have been run to assess the effects of COVID-19 vaccines, finding that these are safe for mass distribution and effective in slowing down the spread of the virus [@Chen.2021;@Polack.2020;@Yap.2021; @Zheng.2022; @Deb.2021], deeming them essential in the fight against the pandemic.

Regarding economic impacts, it is understood that pandemics hamper economic activity through several channels. According to @Brodeur.2021, these channels are the impact of social distancing measures, direct and indirect costs (hospitalization, loss of labor and production) as well as offsetting and cascading effects as the disruption of services are the most important. The direct channels connect macroeconomically to reductions in household consumption and wealth. The macroeconomic models which were studied by @Brodeur.2021 predict a mostly demand-deficient recession, where policy that benefits the economy's supply may not be successful in inducing recovery. Other studies quantified the opportunity cost of shutdowns in the economy, finding that shutdowns put market production in a 25% production deficit, and that medical development and innovation may reduce the shutdown cost in about 70% [@Mulligan.2021]. Additionally, @Deb.2022 find that containment measures hurt economic activity, associating a containment measure with a 10 percent loss in industrial production over 30 days of measure implementation. Regarding business creation, @Meunier.2022 find that newly registered firms fell in 58% of economies in 2020 relative to 2019, when the normal trend was to see new business creation in 2/3 of economies. 

If COVID-19 was indeed an aggregate demand-intensive shock, it is natural to see a fall in business creation as potential customers become wary of spending in an uncertain environment, where health risks appear to affect the likelihood of spending. If vaccines are indeed the best way to fight the pandemic, it would be expected that economies with higher vaccination rates experience higher economic recovery. The effect of vaccines might be two-fold: on one hand more vaccination may foster less pandemic restrictions which would help economic activity as businesses are less restrained. On the other hand, vaccination may foster economic recovery by reducing the likelihood of contagion and thus increase aggregate demand for goods and services, as the likelihood of contracting COVID-19 is smaller. 

@Furceri.2021 develop an empirical model of vaccination and economic effects across 46 countries, finding a positive statistically significant relationship of vaccination rates and economic activity proxied by nitrogen emissions. The effect could be understood as causal given that "vaccine surprises" are used, the key effect being that an unexpected increase in vaccination per capita is associated with increases in economic activity. Furthermore, it has been said that countries with higher vaccination rates were expected to make stronger economic recoveries according to IMF data, as the projections for regions with higher vaccine inequality were revised downward by April 2021 [@UNDP.2022]. However, this analysis does not make a causal investigation, as indeed it is countries that have been historically richer which had higher vaccination rates in 2022. The lack of causal inference research regarding this key topic is evident, considering that the results of the only study which infers a causal effect may not be applicable to countries outside their sample or at time horizons which can include stronger COVID-19 variants. 

# Methodology

## Data

A province-level database was constructed for this paper. Monthly-published data at the province level was recovered from various government sources to construct a repeated cross-section in which every province has 12 observations on several economic and demographic variables. Thus, the database has `r 24*12` observations.

To proxy economic recovery, data from the Ecuadorian regulatory and supervisory public institution for private companies *Superintendencia de Compañías, Valores y Seguros* (SCVS) is used as a dependent variable. Namely, business creation is used as a proxy for economic recovery, based on the [Companies Directory database](https://mercadodevalores.supercias.gob.ec/reportes/directorioCompanias.jsf). The number of businesses created in any given month between January 2020 and December 2021 was computed based on the date of creation of the business in the SCVS system. The following table describes all variables used in the paper.

```{r data_description_table, results = 'asis'}
# Load my data description table from CSv (I did this one on Excel)

data_descrip_df<-read.csv('data/data_table.csv')

# Print a pretty table

datasummary_df(data = data_descrip_df,
               title = 'Variable descriptions and sources')

```

## Empirical approach

A differences-in-differences design is implemented to investigate a potential causal effect of vaccination rates in business creation. The shock that will be exploited for the estimation will be the Delta Variant. This variant of COVID-19 was initially identified in India in late 2020, and spread to the United States in June 2021. It was identified that while the variant's symptoms were the same as the original disease, they seemed to be more severe in the respiratory tract and it also spread quicker. Additionally, the variant seemed to put unvaccinated people at a much higher risk than other variants. It quickly became the principal variant in the United States throughout the fall of 2021 [@Katella.2022; @UCD.2022]. In Ecuador, cases of this variant were initially identified in the summer of 2021 and by October it became the dominant variant in COVID-19 infections [@Mendoza.2021; @Heredia.2021]. This shock is used because given the characteristics of the "new" disease it would be easier to elicit differences in outcomes between groups with different propensity to become vaccinated against COVID-19.

The treatment group will be defined in terms of vaccination hesitancy and actual COVID-19 vaccination rates. In order to accurately exploit vaccination hesitancy and not confound it with logistic/movement restriction issues, the treatment group is defined in reference to the number of vaccine-preventable diseases detected in each province through time. The Ministry of Health has made available yearly vaccine-preventable disease tabloids ([gacetas inmunoprevenibles](https://www.salud.gob.ec/gacetas-inmunoprevenibles/)) which tabulate yearly reported cases of vaccine-preventable diseases at the province level for 2019 and 2020. With this information, the number of vaccine-preventable diseases per thousand is computed with basis to the 2020 population projections (no 2021 projections have been made available). Also, the average monthly vaccination rate is computed, which can be seen at group level in the following table. The treatment group is then composed of the following provinces: Carchi, Chimborazo, Cotopaxi, Morona Santiago, Orellana,  Pastaza, Santo Domingo, Sucumbíos, Zamora Chinchipe. These provinces comply with two conditions: higher than average vaccine-preventable cases per one thousand and lower than average monthly vaccination rates. The following table shows some descriptive statistics for the groups.

```{r group_table}
# Load my data description table from CSv (I did this one on Excel)

group_df<-read.csv('data/group_stat.csv')

# Print a pretty table

datasummary_df(data = group_df,
               output ='markdown',
               title = 'Descriptive Statistics for Treatment and Control Groups',
               col.names = c('Group',
                             'New Businesses 2020', 
                             'New Businesses 2021', 
                             'Mean Monthly Vaccination Rate (%)',
                             'Mean vaccine-preventable cases per thousand'))

```

Having defined treatment and control groups and the exogenous shock, the empirical models to be estimated will be based on the following general equation

$$\ln(bc_{it}+1) = \alpha_i + \alpha_t + \beta_1 T_i + \sum_{j = 2}^{m} \left( \beta_j x_{j} \right) + u_{it}$$
where $\alpha_i$ is a set of coefficients for province fixed effects and $\alpha_t$ is a set of coefficients for period fixed effects (24 periods from January 2020 to December 2021). $\hat{\beta_1}$ will be the point estimate for the two-way fixed effects (TWFE) difference-in-differences estimator, as the dummy variable $T_i$ will equal unity for provinces in the treatment group and period (treatment periods are from September to December 2021). Note that $\beta_1$ equals the coefficient of an interaction term between treatment period treatment group dummies, however, the interaction notation is not used here as introducing a treatment group dummy would induce perfect collinearity. In some of the models estimated, the period dummies are dropped and month fixed effects are included instead as a robustness check. Finally, the $\beta_j$ will be the coefficients on time-varying variables which may affect business creation across the groups. All models estimated will be reported with two-way clustering at the province and month level. Wild bootstrap tests [@Roodman.2019] are done on the DiD estimates to verify their significance. 

Two dependent variables are considered. The first one is total business creation, which is equal to the number of businesses created in the SCVS system in any given month and province. The second is non-SAS business creation. This difference is considered because in February 28th, 2020 a new kind of company *Sociedad de Acciones Simplificada* (SAS) was introduced to the Ecuadorian legislation, and as of May of that year it was possible to create this kind of company. This chance in legislation prompted the swift creation of SAS businesses as the process of creation was considerably easier, faster and chepaer than creating the usual PLC and LLC companies [@Gortaire.2020, @Hanze.2020]. It is adequate to believe that this shock may become a confounder in the identification strategy since Ecuador has been determined to be an entrepreneur-propense country in the region but with a considerable number of informal companies and entry costs [@Hora.2021]. Additionally, it has been already determined through the SCVS data that after a year of the introduction of the SAS, there was a considerable increase in business creation, especially in Quito and Guayaquil [@Franco.2021]. 

Given that the treatment variable implies some sort of vaccine hesitancy among the population of the treated provinces, it would be expected that the TWFE DiD estimator is statistically significant and negative if the hypothesis from the Introduction section holds. This is because after a shock in which the pandemic worsens which induces health concerns among consumers, provinces with more vaccine-hesitant populations see less business creation than provinces with less vaccine hesitant populations. The following section reviews the results of the regressions run to estimate the explained models.

# Results
```{r data-wrangle, include = F}
# Some data wrangling for my regression models

# Create the three dependent variables in log form

df$lbuss<-log(df$buss + 1)

df$lnsas<-log(df$non_sas + 1)

df$lsales<-log(df$sales_pc_k)

df$ltxp<-log(df$txp_change)

df$lsalesc<-log(df$sales_change_pc_k)

# Relevel the treatment group factor

df$treat<-as.factor(df$treat)
df$treat<-relevel(df$treat, 'provax')

# Relevel the period dummies

df$monthyear<-as.factor(df$time_cont)

df$monthyear<-relevel(df$monthyear, '20')

# Create a treatment group dummy

df$treat_dic<-ifelse(df$treat == 'antivax', 1,0)

# Create a treatment period dummy

df$post_dic<-ifelse(df$post == 'post',1,0)

# Create the treated dummy (interaction between treatment group and treatment period)

df$did<-df$treat_dic*df$post_dic

# This last one is equivalent to a dummy equal to unity for observations in treatment provinces and treatment periods

```
## Model Results
```{r did_regressions, include = F}

# ============================================== With Log of total business creation ==================================== # 

# Simple one

simple_lbuss<-
  feols(lbuss ~ did | province + monthyear,
        cluster = ~ province + month,
        data = df)

summary(simple_lbuss)

# With province-month interactions

provmonth_lbuss<-
  feols(lbuss ~ did | province^month,
        cluster = ~ province + month,
        data = df)

summary(provmonth_lbuss)

# With more variables

vars_lbuss<-
  feols(lbuss ~ did + excessd_rate + job_change + v_deaths + robbery + transit_acc | province + monthyear,
        cluster = ~ province + month,
        data = df)

summary(vars_lbuss)

# With vaccine

vax_lbuss<-
  feols(lbuss ~ did + excessd_rate + job_change + v_deaths + robbery + transit_acc + vax_leastone
        | province + monthyear,
        cluster = ~ province + month,
        data = df)

summary(vax_lbuss)

# With trend data

trend_lbuss<-
  feols(lbuss ~ did + excessd_rate + job_change + v_deaths + robbery + transit_acc + time_cont | province,
        cluster = ~ province + month,
        data = df)

summary(trend_lbuss)

# ============================================ With Log of Non-SAS business creation ==================================== #

# Simple one

simple_lnsas<-
  feols(lnsas ~ did | province + monthyear,
        cluster = ~ province + month,
        data = df)

summary(simple_lnsas)

# With province-month interactions

provmonth_lnsas<-
  feols(lnsas~ did | province^month,
        cluster = ~ province + month,
        data = df)

summary(provmonth_lnsas)

# With more variables

vars_lnsas<-
  feols(lnsas ~ did + excessd_rate + job_change + v_deaths + robbery + transit_acc | province + monthyear,
        cluster = ~ province + month,
        data = df)

summary(vars_lnsas)

# With vaccine

vax_lnsas<-
  feols(lnsas ~ did + excessd_rate + job_change + v_deaths + robbery + transit_acc + vax_leastone
        | province + monthyear,
        cluster = ~ province + month,
        data = df)

summary(vax_lnsas)

# With trend data

trend_lnsas<-
  feols(lnsas ~ did + excessd_rate + job_change + v_deaths + robbery + transit_acc + time_cont | province,
        cluster = ~ province + month,
        data = df)

summary(trend_lnsas)

# ============================================ List of regressions ======================================================== 

reg_did_list<-list(simple_lbuss,
                   provmonth_lbuss,
                   vars_lbuss,
                   vax_lbuss,
                   trend_lbuss,
                   simple_lnsas,
                   provmonth_lnsas,
                   vars_lnsas,
                   vax_lnsas,
                   trend_lnsas)

# ========================================== Wild Bootstrap ======================================

# All this stuff has been commented out because the package has a bug *June 2022

# Do wild bootstrap tests of the trend-controlled regressions

# boot_lbuss<-boottest(trend_lbuss,
                     #clustid = c('province', 'month'),
                     #param = 'did',
                     #B = 9999,
                     #seed = 5555)
# summary(boot_lbuss)

# boot_lnsas<-boottest(trend_lnsas,
                     #clustid = c('province', 'month'),
                     #param = 'did',
                     #B = 9999,
                     #seed = 5555)
# summary(boot_lnsas)

# The same but for the variable ones

# boot_lbuss_v<-boottest(vars_lbuss,
   #                  clustid = c('province', 'month'),
  #                   param = 'did',
    #                 B = 9999,
     #                seed = 5555)
# summary(boot_lbuss_v)

# boot_lnsas_v<-boottest(vars_lnsas,
    #                   clustid = c('province', 'month'),
     #                   param = 'did',
      #                 B = 9999,
       #                seed = 5555)
# summary(boot_lnsas_v)

# Sadly, these boottests cannot be run by R for some reason. I'll have to run a stata boottest and edit the final document with those results. Sorry, but I'll post the script in GitHub so that reproducibility can be ensured in some way. 

```

```{r table_regressions, include = F}
modelsummary(reg_did_list,
             output = 'dataframe',
             title = 'TWFE DiD Models Estimates',
             stars = c('*' = .1, '**'=0.05, '***' = .01)) %>% write.xlsx('tables/regression_tables.xlsx')

```

The table above summarizes the estimation results. The Appendix shows results on wild bootstrap tests for the time trend controlled regressions and other models estimated later in the paper.   

Considering total business creation, it is found that the DiD estimate is negative and significant. In all models a smaller amount of total business creation is found in the treatment provinces in the treatment period. Model 2 considers interaction fixed-effects between month and province. With this control it is hoped that both time variant and invariant characteristics within a province are partialled-out from the DiD estimate. Models 3 and 4 consider some time-varying variables which do not affect the direction and statistical significance of the key parameter. It is determined that a one percentage point increase in the excess death rate is associated with an about 13% decrease in business creation. Other variables do not maintain a statistically significant relationship with total business creation. Model 5 accounts for a time trend to control for the possibility of divergent prior trends between treatment and control groups. The DiD estimate significantly increases its magnitude in absolute terms: a 49.5% decrease in business creation is associated with vaccine-hesitant provinces. The time trend is positive and significant. It is also found that an extra one robbery case is 
associated with a 0.01% increase in business creation; this may demonstrate the possibility that provinces with higher economic activity are also more unsafe. Results of the DiD estimate on Models 3 and 5 are robust to the wild bootstrap test as seen in the Appendix.

Models 6-10 follow the same progression as Models 1-5 but considering creation of non-SAS businesses. With this change, the DiD estimate is only statistically significant when controlling for province and month interaction terms and when controlling for time trend. However, the wild bootstrap test carried out on Model 8's DiD estimate shows that the negative average treatment effect is indeed significant at the 95% confidence level. The wild bootstrap test also allow to say that the DiD estimate on Model 8 is statistically significant at the 90% confidence level. The excess death rate coefficient keeps its significance and magnitude except in the case of time-trend model, when a one percentage point increase in the rate is associated with a 22.2% decrease in business creation (non-SAS). The excess rate potentially illustrates two channels of causation between COVID-19 and deaths. The first one is actual COVID-19 deaths, whose official metric may be significantly misrreported, at least during the beginning of the pandemic [@OrtizPrado.2020]. The second one might be the deaths caused by the inability of health systems to cope with all health emergencies during the pandemic as they were saturated from COVID-19 cases. The health system in Ecuador had already been impacted from low government budget [@Mena.nd], which is why this channel of causation would be very significant. Whatever the relative importance these two channels may have on the excess death rate, the fact that the direction of the effect is consistently negative may mean that the partial effect of COVID-19 health impact is consistently detrimental for business creation in Ecuador. 

Additionally, the fact that in models which consider both total and non-SAS business creation the coefficient on vaccination rate is not statistically different from zero supports the idea that the treatment and control groups are well defined as they already capture the differences between real vaccine-hesitancy. 
```{r rob_check_regressions, include = F}
# ============================================ Some robustness checks ========================================== # 

# Drop Pichincha and Guayas

df_smallprov<-df[!(df$province == 'PICHINCHA' | df$province == 'GUAYAS'),]

# Mistreatment: Only pichincha as treatment

df_mistreat<-df

df_mistreat$pich<-ifelse(df_mistreat$province == 'PICHINCHA',1,0)

df_mistreat$pich_treat<-df_mistreat$pich*df_mistreat$post_dic

# Mistreatment two: all provinces in treatment

df_mistreat1<-df

df_mistreat1$treatment_group<-ifelse(df_mistreat1$province == 'ZAMORA CHINCHIPE',0,1)

df_mistreat1$did1<-df_mistreat1$treatment_group * df_mistreat1$post_dic

# Use the time trends model for robustness checks.

# No Pichincha/Guayas

nopich_lbuss<-
  feols(lbuss ~ did + excessd_rate + job_change + v_deaths + robbery + transit_acc + time_cont | province,
        cluster = ~ province + month,
        data = df_smallprov )

nopich_lnsas<-
  feols(lnsas ~ did + excessd_rate + job_change + v_deaths + robbery + transit_acc + time_cont | province,
        cluster = ~ province + month,
        data = df_smallprov )

# Mistreat 1

pich_lbuss<-
  feols(lbuss ~ pich_treat + excessd_rate + job_change + v_deaths + robbery + transit_acc + time_cont | province,
        cluster = ~ province + month,
        data = df_mistreat )

pich_lnsas<-
  feols(lnsas ~ pich_treat+ excessd_rate + job_change + v_deaths + robbery + transit_acc + time_cont | province,
        cluster = ~ province + month,
        data = df_mistreat )


# Now the list

rob_regressions<-list(nopich_lbuss,
                      nopich_lnsas,
                      pich_lbuss,
                      pich_lnsas)
                      
# Bootstrap

bootlbuss1<- boottest(nopich_lbuss,
                      clustid = c('province', 'month'),
                      param = 'did',
                      B = 9999,
                      seed = 5555)
summary(bootlbuss1)

bootlnsas1<- boottest(nopich_lnsas,
                      clustid = c('province', 'month'),
                      param = 'did',
                      B = 9999,
                      seed = 5555)
summary(bootlnsas1)

bootlbuss2<- boottest(pich_lbuss,
                      clustid = c('province', 'month'),
                      param = 'pich_treat',
                      B = 9999,
                      seed = 5555)
summary(bootlbuss2)

bootlnsas2<- boottest(pich_lnsas,
                      clustid = c('province', 'month'),
                      param = 'pich_treat',
                      B = 9999,
                      seed = 5555)
summary(bootlnsas2)

# Modelsummary

modelsummary(rob_regressions,
             output = 'dataframe',
             stars = c('*' = .1, '**'=0.05, '***' = .01)) %>%  write.xlsx('tables/regression_tables_robust.xlsx')

```
The table above considers two robustness checks run on the models which account for time-trends in the previous table, for all two dependent variables used. Models 1-2 confirm that the results of Models 1-2 are robust to dropping the biggest two provinces: Pichincha and Guayas. Changes are seen in the coefficients of the regressors. The excess death rate effect is lost, most likely due to the fact that excess deaths have concentrated on those two provinces throughout the pandemic. Models 4-5 focus on an "alternate" treatment variable which equals 1 for treatment periods and only for province Pichincha. It would be expected that no effect is found with this artificial treatment, as confirmed by the results in the table. All results are also robust to the wild bootstrap test, as seen in the Appendix.

## Justifying Parallel Trends

```{r ptrends_graph, fig.cap='Prior Trends Graph'}
# Load the data

ptrends_graph_df<-read.csv('data/ptrends_graph.csv')

# Plot against time

ptrends_lbuss<-ggplot(ptrends_graph_df,
                      aes(x = period, y = lbuss, color = group))+
               scale_color_manual(values = c('#6495ED', '#FF4500'))+
               geom_line(size = 0.8)+
               geom_point(size = 2.15)+
               geom_vline(xintercept = 21, linetype = 'dotted' )+
               geom_vline(xintercept = 3, linetype = 'dotted') +
               labs(x = '',
                    y = 'Natural Log of Total Business Creation + 1')+
               theme_bw()+
               theme(panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(),
                     legend.background = element_blank(),
                     text = element_text(size = 10))+
               annotate('label', x = 23.2, y = 2, label = 'Treatment\nPeriod',
                        size = 3) + 
               annotate('label', x = 13, y = 2, label = 'COVID-19 Period',
                        size = 3)+
               scale_x_continuous(breaks = c(1,5,9, 13, 17, 21),
                                  labels = c('Jan20', 
                                             'May20',
                                             'Sep20',
                                             'Jan21',
                                             'May21',
                                             'Sep21'))
  
ptrends_lnsas<-ggplot(ptrends_graph_df,
                      aes(x = period, y = lnsas, color = group))+
               scale_color_manual(values = c('#6495ED', '#FF4500'))+
               geom_line(size = 0.8)+
               geom_point(size = 2.15)+
               geom_vline(xintercept = 21, linetype = 'dotted' )+
               geom_vline(xintercept = 3, linetype = 'dotted') +
               labs(x = '',
                    y = 'Natural Log of Non-SAS Business Creation + 1')+
               theme_bw()+
               theme(panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(),
                     legend.background = element_blank(),
                     text = element_text(size = 10))+
               annotate('label', x = 23.2, y = 2, label = 'Treatment\nPeriod',
                        size = 3) + 
               annotate('label', x = 13, y = 2, label = 'Pandemic\nperiod',
                        size = 3) +
               scale_x_continuous(breaks = c(1,5,9, 13, 17, 21),
                                  labels = c('Jan20', 
                                             'May20',
                                             'Sep20',
                                             'Jan21',
                                             'May21',
                                             'Sep21'))

```

```{r graph, fig.width = 10, fig.height= 5, fig.cap = 'Prior trends for the natural logarithm of total and non-SAS business creation' }
ptrends_lbuss + ptrends_lnsas +
  plot_layout(ncol = 2,
              guides = 'collect') &
  theme(legend.position = 'bottom',
        legend.box.background = element_rect(color = 'black')) & 
  labs (color = 'Group')
```
The figure shows both the trends of the natural logarithm + 1 of total business creation and also of non-SAS business creation. Both graphs show business creation seems to move together between groups, specially in the case of total business creation, although for non-SAS business creation a three period lag can be determined in the spike which begins in late 2020. 

To further investigate the possibility of differential prior trends, the following regression is estimated, with pre-treatment data (periods 1-20)

$$ln(bc_{it}) = \theta_i + \theta_t + \theta_k \left( t^* \cdot G_i \right) + \sum_{j} ^ m \beta_j x + {\epsilon_{it}}$$

which considers province and period fixed effects, as well as coefficients $\beta_j$ for all time-varying controls as seen in previous models. $G_i$ is a dummy equal to unity when the observation belongs to a treatment group province. The key parameters for this test regressions are the $\theta_k$, which should not be statistically significant if the prior trends are similar. The reference period for this regressions is set to one period before the shock, meaning the August 2021 period dummy and interaction with treatment group are not estimated. The coefficients on the treatment-period interactions are plotted in the graph below. 

```{r ptrendsreg, include = F, evaluate = F}
# This chunk is suspended right now. I will only consider the prior trends regressions on the following chunk.

# Create the dataframe that I will need for this prior trends regression

df_pt<-subset(df, df$time_cont < 21)

# Create the interaction 

df_pt$group_time<-df_pt$time_cont*df_pt$treat_dic

# Refactor the period factor

df_pt$monthyear<-as.factor(df_pt$time_cont)

df_pt$monthyear<-relevel(df_pt$monthyear, '20')

# Now run the regressions

# Time continuous, no group dummy

time_cont<-

feols(lbuss ~ time_cont + group_time,
      data = df_pt,
      cluster = ~ province + month) 

summary(time_cont)

# Time continuous, with group dummy

time_cont_group<-

feols(lbuss ~ time_cont*treat,
      data = df_pt,
      cluster = ~ province + month) 

summary(time_cont_group)

# Time continuous, no group dummy, province FE

time_cont_provFE<-

feols(lbuss ~ time_cont + group_time | province,
      data = df_pt,
      cluster = ~ province + month)

summary(time_cont_provFE)

# Time continuous, group dummy, province FE

time_cont_provFE_group<-

feols(lbuss ~ time_cont*treat| province,
      data = df_pt,
      cluster = ~ province + month)

summary(time_cont_provFE_group)

# Time dummies, group dummy

timed_groupd<-

feols(lbuss ~ monthyear*treat,
      data = df_pt,
      cluster = ~ province + month)

summary(timed_groupd)

# Time dummies, group dummy, province FE

timed_groupd_provFE<-

feols(lbuss ~ monthyear*treat | province,
      data = df_pt,
      cluster = ~ province + month)

summary(timed_groupd_provFE)

# The same, but changing my dependent variable to non-sas natural log

# Time continuous, no group dummy

time_cont1<-

feols(lnsas ~ time_cont + group_time,
      data = df_pt,
      cluster = ~ province + month) 

summary(time_cont1)

# Time continuous, with group dummy

time_cont_group1<-

feols(lnsas ~ time_cont*treat,
      data = df_pt,
      cluster = ~ province + month) 

summary(time_cont_group1)

# Time continuous, no group dummy, province FE

time_cont_provFE1<-
  
feols(lnsas ~ time_cont + group_time | province,
      data = df_pt,
      cluster = ~ province + month)

summary(time_cont_provFE1)

# Time continuous, group dummy, province FE

time_cont_provFE_group1<-

feols(lnsas ~ time_cont*treat| province,
      data = df_pt,
      cluster = ~ province + month)

summary(time_cont_provFE_group1)

# Time dummies, group dummy

timed_groupd1<-

feols(lnsas ~ monthyear*treat,
      data = df_pt,
      cluster = ~ province + month)

summary(timed_groupd1)

# Time dummies, group dummy, province FE

timed_groupd_provFE1<-

feols(lnsas ~ monthyear*treat | province,
      data = df_pt,
      cluster = ~ province + month)

summary(timed_groupd_provFE1)

# The same, but with sales

# Time continuous, no group dummy

time_cont2<-

feols(lsales ~ time_cont + group_time,
      data = df_pt,
      cluster = ~ province + month) 

summary(time_cont2)

# Time continuous, with group dummy

time_cont_group2<-

feols(lsales ~ time_cont*treat,
      data = df_pt,
      cluster = ~ province + month) 

summary(time_cont_group2)

# Time continuous, no group dummy, province FE

time_cont_provFE2<-

feols(lsales ~ time_cont + group_time | province,
      data = df_pt,
      cluster = ~ province + month)

summary(time_cont_provFE2)

# Time continuous, group dummy, province FE

time_cont_provFE_group2<-

feols(lsales ~ time_cont*treat| province,
      data = df_pt,
      cluster = ~ province + month)

summary(time_cont_provFE_group2)

# Time dummies, group dummy

timed_groupd2<-

feols(lsales ~ monthyear*treat,
      data = df_pt,
      cluster = ~ province + month)

summary(timed_groupd2)

# Time dummies, group dummy, province FE

timed_groupd_provFE2<-

feols(lsales ~ monthyear*treat | province,
      data = df_pt,
      cluster = ~ province + month)

summary(timed_groupd_provFE2)


# List of all total business regressions for my table of models

test_regressions_pt<-
  list(time_cont,
       time_cont_group,
       time_cont_provFE,
       time_cont_provFE_group,
       timed_groupd,
       timed_groupd_provFE)

test_regressions_pt_nsas<-
  list(time_cont1,
       time_cont_group1,
       time_cont_provFE1,
       time_cont_provFE_group1,
       timed_groupd1,
       timed_groupd_provFE1)

test_regressions_pt_sales<-
  list(time_cont2,
       time_cont_group2,
       time_cont_provFE2,
       time_cont_provFE_group2,
       timed_groupd2,
       timed_groupd_provFE2)


```

```{r ptrendsreg1, include = F}
# Do the test regressions with all periods, using reference level August 2021

# Refactor the period factor for the reference level

df$monthyear<-as.factor(df$time_cont)

df$monthyear<-relevel(df$monthyear, '20')

# Run the test regressions

test_lbuss<-
  feols(lbuss ~ + monthyear*treat + excessd_rate + job_change + v_deaths + robbery + transit_acc | province,
        cluster = ~ province + month,
        data = df)

summary(test_lbuss)

test_lnsas<-
  feols(lnsas ~ + monthyear*treat + excessd_rate + job_change + v_deaths + robbery + transit_acc | province,
        cluster = ~ province + month,
        data = df)

summary(test_lnsas)

# Now to modelsummary 

modelsummary(list(test_lbuss, test_lnsas),
             output = 'dataframe') %>% write.xlsx('tables/coefplot.xlsx')

# Load the data for my graph

df_coefplot<-read.csv('data/coefplot.csv')


```

```{r prior_graphs, include = F}

ptrendsreg_lbuss<-ggplot(df_coefplot,
                         aes(x = period_numb, y = lbuss_coef))+
               geom_line(size = 0.8, color = '#1a53ff')+
               geom_point(size = 2.15)+
               geom_errorbar(aes(ymin = lbuss_coef-(1.96*se_lbuss),
                                 ymax = lbuss_coef+(1.96*se_lbuss)),
                             width = 0.5)+
               geom_vline(xintercept = 21, linetype = 'dotted' )+
               geom_vline(xintercept = 3, linetype = 'dotted') +
               geom_hline(yintercept = 0, linetype = 'dotted') +
               labs(x = '',
                    y = 'Effect on Total Business Creation')+
               theme_bw()+
               theme(panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(),
                     legend.background = element_blank(),
                     text = element_text(size = 10))+
               scale_x_continuous(breaks = c(1,5,9, 13, 17, 21),
                                  labels = c('Jan20', 
                                             'May20',
                                             'Sep20',
                                             'Jan21',
                                             'May21',
                                             'Sep21'))

ptrendsreg_lnsas<-ggplot(df_coefplot,
                         aes(x = period_numb, y = lnsas_coef))+
               geom_line(size = 0.8, color = '#1a53ff')+
               geom_point(size = 2.15)+
               geom_errorbar(aes(ymin = lnsas_coef-(1.96*se_lnsas),
                                 ymax = lnsas_coef+(1.96*se_lnsas)),
                             width = 0.5)+
               geom_vline(xintercept = 21, linetype = 'dotted' )+
               geom_vline(xintercept = 3, linetype = 'dotted') +
               geom_hline(yintercept = 0, linetype = 'dotted') +
               labs(x = '',
                    y = 'Effect on Non-SAS Business Creation')+
               theme_bw()+
               theme(panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(),
                     legend.background = element_blank(),
                     text = element_text(size = 10))+
               scale_x_continuous(breaks = c(1,5,9, 13, 17, 21),
                                  labels = c('Jan20', 
                                             'May20',
                                             'Sep20',
                                             'Jan21',
                                             'May21',
                                             'Sep21'))

```
```{r graphs_test, fig.width = 10, fig.height= 5, fig.cap = 'Prior trends for the natural logarithm of total and non-SAS business creation'}
# Now, print out both graphs in only one figure.
ptrendsreg_lbuss + ptrendsreg_lnsas +
  plot_layout(ncol = 2)
```
Results show that for total business creation there is a possibility for differential prior trends because of the earliest periods. The difference could be born from the changes caused by the pandemic onset in Ecuador in mid-March, but these results suggest the need to correct for differential prior trends by including a continuous time variable in the regressions, as it was done on some of the models that were shown in the previous section. For non-SAS business creation, two period-treatment interactions are marginally significant, November and June 2021. This makes the case for a better compliance of the parallel trends assumption in DiD models for the non-SAS business creation dependent variable. This further supports the idea that SAS company creation may be a significant confounder in causal inference for the effect of vaccination on economic recovery. With this information, it is sensible to believe that a better estimate of the average treatment effect can be found in the models that leave out SAS company creation. 

# Conclusions

This paper prompts a discussion focused on causality about the effect of vaccination on economic recovery. The COVID-19 pandemic significantly disrupted business activity, but hope for return to normality existed when several vaccines were approved for mass distribution. It would be thought that vaccines may reduce the aversion to health issues from consumers, considering that a full dose has been proven to be effective in significantly reducing chances of infection. However, the evidence found from empirical modelling in Ecuador between 2020-2021 does not allow to definitely accept a causal effect of vaccines in economic recovery existed in the country.

Using total business creation data from the Ecuadorian Companies, Securities and Insurance Superintendency and a two-way fixed effects difference-in-differences estimator, some models found that provinces with populations that appear to be vaccine-hesitant saw less business creation after the Delta Variant shock in September 2021. Namely, an average treatment effect (ATE) of about -21.5\% is estimated with a regression-based DiD design with time-varying controls. This result is significant at the 99% confidence level after a wild bootstrap test on the DiD coefficient. However, statistical testing suggest a possibility of differential prior-trends. To control this, a continuous time variable (trend) is added to the model. In this case, a -49.5% ATE is estimated. This result is statistically significant at the 95% level. However, this estimate must not be considered without reservation, as @HuntingtonKlein.2021 suggests that controlling for time trend may bias the estimation. 

Lesser evidence of differential prior-trends is found with non-SAS business creation. The Simplified Shares Society (SAS) was introduced in Ecuador in mid 2020, so it is possible that total business creation is affected by noise caused by the spark in creation of SAS companies, which offered a less difficult legal constitution process. Using this variable in the modelling allows to determine a -25.8% ATE after controlling for time-varying factors. After controlling for time trends, the DiD estimate is -45.8%, significant at the 90% confidence level. All of these results are robust to dropping the two biggest provinces Pichincha and Guayaquil and switching Pichincha to the sole treatment variable. 

The most statistically reliable estimate is the one obtained from the regression of the natural log of non-SAS business creation. This means that for provinces which appear to be more vaccine-hesitant 25.8% less non-SAS business are created relative to provinces which are more open to be vaccinated. This finding stresses the importance of adequate mechanisms of vaccine distribution, given that speedy vaccination proccesses as the one implemented by the Lasso Administration seem to be positive for the economy. However, there might still be reason to believe the coefficient is biased upward. In principle, the fact that vaccine-hesitant provinces see less business creation might be due to the fact that they also see higher amounts of COVID-19 cases, and thus have stricter pandemic restrictions. There is no clear way of how to quantify the degree of restrictions in Ecuador at the province-level. Using Google Mobility Reports is not useful as it might purposely partial-out economic activity effects from the DiD coefficients. Additionally, it has been mentioned that it is not recommended to use this data for over six month analyses, as mobility trends might change and the January-February 2020 baselines are not useful for making comparisons [@Google.nd]. No other data which might measure mobility has been prepared for Ecuador, and even so it might still be difficult to believe the data is representative, as often pandemic measures might not be obeyed by all the population, with specific provinces behaving more recklessly than others [@Salazar.2022; @Gonzalez.2021). 

Further, given the possibility that there are differential prior trends (although small) and that time trend controls may not be useful for eliciting true causal effects, there would be a need to redesign the causal research framework, perhaps by selecting other kinds of treatment groups and/or shocks. The Omicron variant may pose as a stronger exogenous shock that can be investigated as a natural experiment, although the relatively mild symptoms it causes might not allow to see true diverging trends between treatment groups. As an alternative, analyzing greater time horizons and using multiple timing of treatments in the DiD design, depending on the availability of data. Using greater amounts of data and perhaps studying multiple countries in a same continent might be a good way to average out confounding effects such as the reduction of entry costs, such as the establishment of the SAS. The fact that removing SAS companies might also be evidence for the idea that in Ecuador formal business creation is driven by entry costs, which means that business creation may not accurately represent economic recovery. However, no other variables exist at the frequency and regional hierarchy that can proxy economic activity as well as business creation. While variations in job contract amounts and number of taxpayers in the IRS system might be used, these might pose problems of their own as measurement error or simultaneity with the explanatory variables. All in all, this paper makes an initial attempt at inferring causality using empirical research, and the findings seem to be in line with what is expected of the vaccination process in the health community as well as the findings by @Furceri.2021. 

# Appendix

# References

```{r boot_lsales, include = F}
boot_models<-list(boot_lbuss,
                  boot_lnsas,
                  bootlbuss1,
                  bootlnsas1,
                  bootlbuss2,
                  bootlnsas2)
```



```{r wild_boot_table}
# First i need to generate a finished df for me to use in stata

write.csv(df, 'data/data_for_stata.csv')

modelsummary(boot_models,
             estimate = "{estimate} ({p.value})", 
             statistic = "[{conf.low}; {conf.high}]",
             output = 'data.frame',
             title = 'Wild bootstrap test results') %>% write.xlsx('tables/bootstrap.xlsx')
```



